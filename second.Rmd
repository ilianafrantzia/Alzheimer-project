---
title: "DSC 532- Fuel Regression project"
output: pdf_document
date: "2025-04-01"
---

Dataset Overview
Observations: 1,067 rows (vehicles)
Variables: 13 columns
Purpose: Contains fuel consumption and CO2 emissions data for vehicles from the year 2014




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Import Libraries
```{r libraries, message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(moments)
library(nortest)
library(corrplot)
library(caret)
library(tidyr)
```
Load the FuelConsumption dataset and preview the first 6 rows of the dataset.

```{r load-data, message=FALSE}
data <- read.csv("FuelConsumption.csv")
head(data)
```

The dataset includes features like:

```{r}
colnames(data)
``` 
Data types and Structure of the dataset.
```{r}
str(data)
```


Statistical summary of numerical variables.

From the summary table we can observe that vehicles with larger engines and more cylinders tend to have higher fuel consumption and CO₂ emissions.

Also,there's a wide variety of fuel efficiency, from very eco-friendly models to high-emission vehicles.

```{r}
summary(data)
```
Statistical summary of numerical variables.

From the summary table we can observe that vehicles with larger engines and more cylinders tend to have higher fuel consumption and CO₂ emissions.

Also,there's a wide variety of fuel efficiency, from very eco-friendly models to high-emission vehicles.

From the model year column we can observe that all the cars are from 2014

 
```{r}

colSums(is.na(data))  # This gives you count of NAs per column

```

We have 0 missing values, so we don’t need to impute or remove anything.

```{r}

# Number of duplicated rows
sum(duplicated(data))

```

There are no duplicated rows in the dataset

```{r}

# Check unique values for categorical columns
cat_cols <- names(data)[sapply(data, is.character)]

# Apply unique() to each categorical column and name the output
unique_values <- lapply(data[cat_cols], unique)

# Display the unique values nicely
unique_values


```

The dataset contains a rich variety of categorical features, including 39 car makes, hundreds of models, 16 vehicle classes, multiple transmission types, and 4 fuel types.

All categorical columns are free of spelling errors, case inconsistencies, or data entry mistakes.


## Including Plots

You can also embed plots, for example:
library(tidyr)
```{r wide-histogram, fig.width=10, fig.height=6}
numeric_vars <- data %>% select(ENGINESIZE, CYLINDERS, FUELCONSUMPTION_COMB, CO2EMISSIONS)

numeric_vars %>%
  gather() %>%
  ggplot(aes(value)) +
  facet_wrap(~ key, scales = "free", ncol = 2) +
  geom_histogram(bins = 30, fill = "steelblue", color = "white") +
  theme_minimal() +
  labs(title = "Distribution of Key Numeric Variables")
```


CO2EMISSIONS: Most values are concentrated between 150 and 300 g/km, with a gradual decline toward higher emissions. This suggests that have a slightly skewed distribution.

CYLINDERS: The distribution is clearly categorical, with strong peaks at 4, 6, and 8 cylinders—indicating these are the dominant engine types in the dataset.

ENGINESIZE: Smaller engines (2 to 3.5 liters) are more common, while larger engines appear less frequently. The data is not perfectly symmetrical, showing some right skew.

FUELCONSUMPTION_COMB: The majority of vehicles consume around 8 to 12 liters per 100 km. Fewer vehicles fall into the higher consumption range, again showing a right-skewed shape.


dataset$calculated_mpg <- 235.214583 / dataset$FUELCONSUMPTION_COMB
# Compute the difference between reported and calculated MPG
dataset$mpg_difference <- dataset$FUELCONSUMPTION_COMB_MPG - dataset$calculated_mpg
# Set threshold as the 95th percentile
percentile_95 <- quantile(dataset$mpg_difference, 0.95)
print(percentile_95)
# Count values exceeding the threshold
sum(dataset$mpg_difference > percentile_95) #52
#So there are 52 rows that we could delete since they do not satisfy the 
#formula we use.

#2. Check if the combutations are done correctly when calculating the
#   FUELCONSUMPTION_COMB

# Calculate the simple average
dataset$simple_avg <- (dataset$FUELCONSUMPTION_CITY + dataset$FUELCONSUMPTION_HWY) / 2

# Calculate the weighted average (55% city, 45% hwy)
dataset$weighted_avg <- 0.55 * dataset$FUELCONSUMPTION_CITY + 0.45 * dataset$FUELCONSUMPTION_HWY

# Compare to the actual COMB column
dataset$diff_simple <- abs(dataset$FUELCONSUMPTION_COMB - dataset$simple_avg)
dataset$diff_weighted <- abs(dataset$FUELCONSUMPTION_COMB - dataset$weighted_avg)

# Average absolute differences
mean(dataset$diff_simple)
mean(dataset$diff_weighted)

#We first perform some tests to see which formula is used for the calculation
#of the average of fuel consumption in city and in highway.
#The two possible averages is the simple average and the 55/45 weighted average.
#By looking at the mean above, we can see that the formula with the lower 
#mean difference is the one likely used to compute. 
#So the formula used is:
#        COMB = 0.55 x CITY + 0.45 x HWY

#The next step is to set a threshold:
#A proper threshold could be around 0.1 since the mean difference is close 
#to 0.02510778
#We can also check by using the IQR method
Q1 <- quantile(dataset$diff_weighted, 0.25)
Q3 <- quantile(dataset$diff_weighted, 0.75)
IQR <- Q3 - Q1

threshold <- Q3 + 1.5 * IQR  # Upper threshold
print(threshold)

sum(dataset$diff_weighted > threshold)
#Does not give us anything. So we use the 0.1 threshold.
sum(dataset$diff_weighted>0.1)
#Since also with 0.1 threshold we can see that there are no points with 
#possible noise, we assume that all the calculations are done correctly.


```{r pressure, echo=FALSE}
# Scatterplots with trend lines
ggplot(data, aes(x = ENGINESIZE, y = CO2EMISSIONS)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "red") +
  theme_minimal() +
  labs(title = "CO2 Emissions vs Engine Size", x = "Engine Size (L)", y = "CO2 Emissions (g/km)")
```

There is a clear positive relationship. As fuel consumption increases, CO2 emissions also increase. The points are close to the line, showing a strong connection.





```{r pressure, echo=FALSE}
ggplot(data, aes(x = FUELCONSUMPTION_COMB, y = CO2EMISSIONS)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "darkgreen") +
  theme_minimal() +
  labs(title = "CO2 Emissions vs Combined Fuel Consumption")
```

This plot also shows a positive trend. Vehicles with bigger engines usually produce more CO2, but the points are more spread out, so the relationship is not as strong as with fuel consumption.




```{r pressure, echo=FALSE}
ggplot(data, aes(x = FUELTYPE, y = CO2EMISSIONS, fill = FUELTYPE)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "CO2 Emissions by Fuel Type", x = "Fuel Type", y = "CO2 Emissions (g/km)") +
  theme(legend.position = "none")  

```

CO2 Emissions by Fuel Type:

Vehicles using fuel type E tend to have the highest CO2 emissions based on the median.
Fuel type D shows the lowest median emissions.
All fuel types show some variation, but type E also has a wider range and more high outliers.

install.packages("GGally")
library(GGally)
library(dplyr)
```{r pressure, echo=FALSE}
ggpairs(data %>% select(ENGINESIZE, CYLINDERS, FUELCONSUMPTION_COMB, CO2EMISSIONS))

```


library(corrplot)
```{r pressure, echo=FALSE}
# Only numeric columns
cor_data <- data %>% select_if(is.numeric)
cor_matrix <- cor(cor_data)

# Plot
corrplot(cor_matrix, method = "color", type = "upper", tl.cex = 0.8, title = "Correlation Matrix", mar=c(0,0,1,0))
```



Dark blue = strong positive correlation (close to +1)
Dark red = strong negative correlation (close to -1)
Lighter colors = weak or no correlation (close to 0)

CO2EMISSIONS is strongly linked to:
FUELCONSUMPTION_COMB
FUELCONSUMPTION_CITY
FUELCONSUMPTION_HWY
ENGINESIZE and CYLINDERS

FUELCONSUMPTION_COMB_MPG is negatively related to CO2 (more MPG = less emissions).

MODELYEAR has no clear connection with the other variables.


Simple Linear Regression

# Fit the model
model_simple <- lm(CO2EMISSIONS ~ FUELCONSUMPTION_COMB, data = data)

# See the summary
summary(model_simple)

```{r pressure, echo=FALSE}
ggplot(data, aes(x = FUELCONSUMPTION_COMB, y = CO2EMISSIONS)) +
  geom_point(color = "black", alpha = 0.6) +
  geom_smooth(method = "lm", color = "blue") +
  labs(title = "Simple Linear Regression: CO2 vs Fuel Consumption",
       x = "Combined Fuel Consumption (L/100km)",
       y = "CO2 Emissions (g/km)") +
  theme_minimal()
```

# Simple linear regression: CO2 vs Engine Size
model_engine <- lm(CO2EMISSIONS ~ ENGINESIZE, data = data)

# Show the summary
summary(model_engine)

```{r pressure, echo=FALSE}
ggplot(data, aes(x = ENGINESIZE, y = CO2EMISSIONS)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Simple Linear Regression: CO2 vs Engine Size",
       x = "Engine Size (L)",
       y = "CO2 Emissions (g/km)") +
  theme_minimal()
```



Both variables are strong predictors of CO2 emissions.
The model with FUELCONSUMPTION_COMB explains slightly more of the variation (R² = 0.796 vs 0.764).
Residuals are smaller in the first model, which also suggests a better fit.
Both models are statistically significant and show clear positive trends.
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
